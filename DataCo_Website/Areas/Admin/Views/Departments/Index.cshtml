@model IEnumerable<DataCo_Website.Models.Department>

@{
    ViewData["Title"] = "Quản lý Phòng Ban";
    var currentPage = ViewBag.Page as int? ?? 1;
    var totalPages = ViewBag.TotalPages as int? ?? 1;
}

<style>
    .action-panel {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        padding: 1.5rem;
        color: white;
        margin-bottom: 1.5rem;
    }

        .action-panel .btn-create {
            background: white;
            color: #667eea;
            border: none;
            font-weight: 600;
        }

            .action-panel .btn-create:hover {
                background: #f8f9fa;
                transform: translateY(-2px);
            }
</style>

<!-- Action Panel with gradient background -->
<div class="action-panel">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h5 class="mb-1">
                <i class="fas fa-building"></i> Danh sách phòng ban
            </h5>
            <small>Quản lý tất cả phòng ban trong hệ thống</small>
        </div>
        <div>
            <a asp-action="Create" class="btn btn-create">
                <i class="fas fa-plus-circle"></i> Thêm Phòng Ban
            </a>
        </div>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        <i class="fas fa-check-circle"></i> @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Departments Table -->
<div class="card">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th><i class="fas fa-hashtag"></i> ID</th>
                    <th><i class="fas fa-building"></i> Tên Phòng Ban</th>
                    <th><i class="fas fa-map-marker-alt"></i> Địa Chỉ</th>
                    <th><i class="fas fa-circle"></i> Trạng Thái</th>
                    <th class="text-center" style="width: 150px;"><i class="fas fa-cog"></i> Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @if (Model == null || !Model.Any())
                {
                    @for (int i = 0; i < 10; i++)
                    {
                        <tr class="skeleton-row">
                            <td><div class="skeleton skeleton-badge"></div></td>
                            <td><div class="skeleton skeleton-text"></div></td>
                            <td><div class="skeleton skeleton-text"></div></td>
                            <td><div class="skeleton skeleton-badge"></div></td>
                            <td><div class="skeleton skeleton-text"></div></td>
                        </tr>
                    }
                }
                else
                {
                    @foreach (var item in Model)
                    {
                        <tr class="@(item.IsActive ? "" : "table-secondary text-muted") fade-in">
                            <td>
                                <span class="badge bg-info text-dark">#@item.DepartmentId</span>
                            </td>
                            <td>
                                <strong class="text-truncate d-inline-block" style="max-width: 250px;" title="@item.DepartmentName">
                                    @item.DepartmentName
                                </strong>
                            </td>
                            <td>
                                <small class="text-muted">
                                    @(item.AddressLine ?? "Chưa cập nhật")
                                </small>
                            </td>
                            <td class="text-center">
                                @if (item.IsActive)
                                {
                                    <span class="badge bg-success">
                                        <i class="fas fa-check"></i> Active
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-danger">
                                        <i class="fas fa-ban"></i> Inactive
                                    </span>
                                }
                            </td>
                            <td class="text-center">
                                <div class="d-flex justify-content-center gap-1">
                                    <a asp-action="Details" asp-route-id="@item.DepartmentId"
                                       class="btn btn-sm btn-info p-1" title="Chi tiết" style="width: 30px; height: 30px;">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a asp-action="Edit" asp-route-id="@item.DepartmentId"
                                       class="btn btn-sm btn-warning p-1" title="Sửa" style="width: 30px; height: 30px;">
                                        <i class="fas fa-edit"></i>
                                    </a>

                                    @if (item.IsActive)
                                    {
                                        <a asp-action="Delete" asp-route-id="@item.DepartmentId"
                                           class="btn btn-sm btn-danger p-1" title="Vô hiệu hóa" style="width: 30px; height: 30px;">
                                            <i class="fas fa-ban"></i>
                                        </a>
                                    }
                                    else
                                    {
                                        <form asp-action="Restore" method="post" class="d-inline">
                                            <input type="hidden" name="id" value="@item.DepartmentId" />
                                            <button type="submit" class="btn btn-sm btn-success p-1" title="Khôi phục" style="width: 30px; height: 30px;"
                                                    onclick="return confirm('Bạn có chắc muốn kích hoạt lại phòng ban này?')">
                                                <i class="fas fa-undo"></i>
                                            </button>
                                        </form>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
@if (totalPages > 1)
{
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                <a class="page-link" asp-action="Index" asp-route-page="@(currentPage - 1)">
                    <i class="fas fa-chevron-left"></i> Previous
                </a>
            </li>

            @{
                int start = Math.Max(1, currentPage - 2);
                int end = Math.Min(totalPages, currentPage + 2);

                if (start > 1)
                {
                    <li class="page-item">
                        <a class="page-link" asp-action="Index" asp-route-page="1">1</a>
                    </li>
                    if (start > 2)
                    {
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    }
                }

                for (int i = start; i <= end; i++)
                {
                    <li class="page-item @(i == currentPage ? "active" : "")">
                        <a class="page-link" asp-action="Index" asp-route-page="@i">@i</a>
                    </li>
                }

                if (end < totalPages)
                {
                    if (end < totalPages - 1)
                    {
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    }
                    <li class="page-item">
                        <a class="page-link" asp-action="Index" asp-route-page="@totalPages">@totalPages</a>
                    </li>
                }
            }

            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                <a class="page-link" asp-action="Index" asp-route-page="@(currentPage + 1)">
                    Next <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>
}

<!-- Info Note -->
<div class="mt-4">
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <strong>Lưu ý:</strong> Khi vô hiệu hóa phòng ban, các category và product thuộc phòng ban này sẽ không hiển thị trên giao diện user, nhưng trạng thái IsActive của chúng không bị thay đổi.
    </div>
</div>
